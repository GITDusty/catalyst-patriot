---
phase: 01-core-visualization-(mvp)
plan: 02
type: execute
wave: 2
depends_on: [01-01]
files_modified:
  - app/components/charts/BudgetDonut.tsx
  - app/components/modals/CategoryDialog.tsx
  - app/components/tables/CategoryTable.tsx
autonomous: true

must_haves:
  truths:
    - "User can view an interactive donut chart of top-level categories"
    - "User can open a drill-down dialog to see subcategory details"
    - "Chart has a linked text alternative table for accessibility"
  artifacts:
    - path: "app/components/charts/BudgetDonut.tsx"
      provides: "Recharts donut with click tooltip and selection"
    - path: "app/components/modals/CategoryDialog.tsx"
      provides: "Radix dialog for subcategory drill-down"
    - path: "app/components/tables/CategoryTable.tsx"
      provides: "Accessible data table text alternative"
  key_links:
    - from: "app/components/charts/BudgetDonut.tsx"
      to: "app/components/modals/CategoryDialog.tsx"
      via: "onSelectCategory callback"
      pattern: "onSelectCategory|setSelected"
    - from: "app/components/charts/BudgetDonut.tsx"
      to: "app/components/tables/CategoryTable.tsx"
      via: "aria-describedby id"
      pattern: "aria-describedby"
---

<objective>
Deliver the interactive chart, drill-down modal, and text alternative components.

Purpose: Provide the core interactive visualization and accessible alternatives required by Phase 1.
Output: Recharts donut component, Radix dialog drill-down, and reusable data table.
</objective>

<execution_context>
@/Users/dustanbruggeman/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/dustanbruggeman/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-visualization-(mvp)/01-RESEARCH.md
@app/data/budget-types.ts
@app/data/florida-budget.ts
@app/utils/formatting.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build the donut chart component</name>
  <files>app/components/charts/BudgetDonut.tsx</files>
  <action>
    Create a client component using Recharts:
    - Wrap `PieChart` with `ResponsiveContainer` and ensure parent has a fixed height.
    - Use `Pie` with `innerRadius` for a donut and `dataKey="value"` + `nameKey="name"`.
    - Enable touch-friendly details by setting `Tooltip` to `trigger="click"`.
    - Accept props: `data`, `total`, `onSelectCategory`, `tableId` (for aria-describedby),
      and optional `activeCategory` for highlighting.
    - Provide a consistent palette via CSS variables (e.g. `var(--chart-1)` etc.).

    Avoid hover-only interactions and avoid fixed-width sizing without `ResponsiveContainer`.
  </action>
  <verify>npm run lint</verify>
  <done>Donut chart renders from provided data and exposes click selection + tooltip.</done>
</task>

<task type="auto">
  <name>Task 2: Implement the drill-down dialog</name>
  <files>app/components/modals/CategoryDialog.tsx</files>
  <action>
    Create a client component using Radix Dialog:
    - Accept `open`, `onOpenChange`, `category`, `fiscalYear`, and `total` props.
    - Provide `Dialog.Title` and `Dialog.Description` for accessibility.
    - Show a subcategory table or list with values + percent (use formatting helpers).
    - Include a close button with accessible label and focus styles.

    Ensure the dialog works on mobile and does not rely on hover.
  </action>
  <verify>npm run lint</verify>
  <done>Dialog opens with category details and subcategory breakdown.</done>
</task>

<task type="auto">
  <name>Task 3: Create the accessible category table component</name>
  <files>app/components/tables/CategoryTable.tsx</files>
  <action>
    Build a reusable table component for text alternatives:
    - Accept `id`, `caption`, `items`, and `total` props.
    - Render a semantic `<table>` with `<caption>`, `<thead>`, `<tbody>`.
    - Provide formatted value and percent for each row using helpers.
    - Keep the structure simple so it can be used for top-level categories and subcategories.

    Link this table from the chart via `aria-describedby` using the provided id.
  </action>
  <verify>npm run lint</verify>
  <done>Table component provides a clear, screen-reader-friendly data alternative.</done>
</task>

</tasks>

<verification>
- npm run lint
</verification>

<success_criteria>
- Donut chart supports click/tap interactions and renders with a responsive container.
- Drill-down dialog shows subcategory details with accessible labeling.
- A text alternative table is available and linkable from the chart.
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-visualization-(mvp)/01-02-SUMMARY.md`
</output>
